javascript: (function () {    
  /* check we're on play.google.com/store/account */
  if (window.location.href.indexOf("play.google.com/store/account") < 0) {
    if (confirm("This bookmarklet only works on play.google.com/store/account. Do you want to go there now?")) {
      window.location.href = "https://play.google.com/store/account";
    }
    return;
  }
  
  $(function() {
    /* only allow one instantiation of script */
    if (typeof $ != "undefined" && $.playstoreenhancer) {
      alert("App List Enhancer already loaded!");
      return;
    }    
    
    $.playstoreenhancer = true;
    
    /******* include libraries *******/
    /*!
    * TableSorter 2.13.3 min - Client-side table sorting with ease!
    * Copyright (c) 2007 Christian Bach
    */
    !(function(f){f.extend({tablesorter:new function(){function c(){var a=1<arguments.length?Array.prototype.slice.call(arguments):arguments[0];"undefined"!==typeof console&&"undefined"!==typeof console.log?console.log(a):alert(a)}function n(a,b){c(a+" ("+((new Date).getTime()-b.getTime())+"ms)")}function l(a){for(var b in a)return!1;return!0}function p(a,b,d){if(!b)return"";var h=a.config,c=h.textExtraction,g="",g="simple"===c?h.supportsTextContent?b.textContent:f(b).text():"function"===typeof c?c(b, a,d):"object"===typeof c&&c.hasOwnProperty(d)?c[d](b,a,d):h.supportsTextContent?b.textContent:f(b).text();return f.trim(g)}function w(a){var b=a.config,d=b.$tbodies=b.$table.children("tbody:not(."+b.cssInfoBlock+")"),h,x,g,k,q,f,m,A="";if(0===d.length)return b.debug?c("*Empty table!* Not building a parser cache"):"";b.debug&&(m=new Date,c("Detecting parsers for each column"));d=d[0].rows;if(d[0])for(h=[],x=d[0].cells.length,g=0;g<x;g++){k=b.$headers.filter(":not([colspan])");k=k.add(b.$headers.filter('[colspan="1"]')).filter('[data-column="'+ g+'"]:last');q=b.headers[g];f=e.getParserById(e.getData(k,q,"sorter"));b.empties[g]=e.getData(k,q,"empty")||b.emptyTo||(b.emptyToBottom?"bottom":"top");b.strings[g]=e.getData(k,q,"string")||b.stringTo||"max";if(!f)a:{k=a;q=d;f=-1;for(var l=g,t=void 0,y=e.parsers.length,v=!1,s="",t=!0;""===s&&t;)f++,q[f]?(v=q[f].cells[l],s=p(k,v,l),k.config.debug&&c("Checking if value was empty on row "+f+", column: "+l+': "'+s+'"')):t=!1;for(;0<=--y;)if((t=e.parsers[y])&&"text"!==t.id&&t.is&&t.is(s,k,v)){f=t;break a}f= e.getParserById("text")}b.debug&&(A+="column:"+g+"; parser:"+f.id+"; string:"+b.strings[g]+"; empty: "+b.empties[g]+"\n");h.push(f)}b.debug&&(c(A),n("Completed detecting parsers",m));b.parsers=h}function z(a){var b=a.tBodies,d=a.config,h,x,g=d.parsers,k,q,r,m,A,l,t,y=[];d.cache={};if(!g)return d.debug?c("*Empty table!* Not building a cache"):"";d.debug&&(t=new Date);d.showProcessing&&e.isProcessing(a,!0);for(m=0;m<b.length;m++)if(d.cache[m]={row:[],normalized:[]},!f(b[m]).hasClass(d.cssInfoBlock)){h= b[m]&&b[m].rows.length||0;x=b[m].rows[0]&&b[m].rows[0].cells.length||0;for(q=0;q<h;++q)if(A=f(b[m].rows[q]),l=[],A.hasClass(d.cssChildRow))d.cache[m].row[d.cache[m].row.length-1]=d.cache[m].row[d.cache[m].row.length-1].add(A);else{d.cache[m].row.push(A);for(r=0;r<x;++r)k=p(a,A[0].cells[r],r),k=g[r].format(k,a,A[0].cells[r],r),l.push(k),"numeric"===(g[r].type||"").toLowerCase()&&(y[r]=Math.max(Math.abs(k)||0,y[r]||0));l.push(d.cache[m].normalized.length);d.cache[m].normalized.push(l)}d.cache[m].colMax= y}d.showProcessing&&e.isProcessing(a);d.debug&&n("Building cache for "+h+" rows",t)}function B(a,b){var d=a.config,h=d.widgetOptions,c=a.tBodies,g=[],k=d.cache,q,r,m,A,p,t,y,v,s,u,w;if(!l(k)){d.debug&&(w=new Date);for(v=0;v<c.length;v++)if(q=f(c[v]),q.length&&!q.hasClass(d.cssInfoBlock)){p=e.processTbody(a,q,!0);q=k[v].row;r=k[v].normalized;A=(m=r.length)?r[0].length-1:0;for(t=0;t<m;t++)if(u=r[t][A],g.push(q[u]),!d.appender||d.pager&&!(d.pager.removeRows&&h.pager_removeRows||d.pager.ajax))for(s=q[u].length, y=0;y<s;y++)p.append(q[u][y]);e.processTbody(a,p,!1)}d.appender&&d.appender(a,g);d.debug&&n("Rebuilt table",w);b||d.appender||e.applyWidget(a);f(a).trigger("sortEnd",a);f(a).trigger("updateComplete",a)}}function E(a){var b=[],d={},h=0,c=f(a).find("thead:eq(0), tfoot").children("tr"),g,k,e,r,m,l,n,p,u,v;for(g=0;g<c.length;g++)for(m=c[g].cells,k=0;k<m.length;k++){r=m[k];l=r.parentNode.rowIndex;n=l+"-"+r.cellIndex;p=r.rowSpan||1;u=r.colSpan||1;"undefined"===typeof b[l]&&(b[l]=[]);for(e=0;e<b[l].length+ 1;e++)if("undefined"===typeof b[l][e]){v=e;break}d[n]=v;h=Math.max(v,h);f(r).attr({"data-column":v});for(e=l;e<l+p;e++)for("undefined"===typeof b[e]&&(b[e]=[]),n=b[e],r=v;r<v+u;r++)n[r]="x"}a.config.columns=h+1;return d}function C(a){var b=E(a),d,h,x,g,k,q,r,m=a.config;m.headerList=[];m.headerContent=[];m.debug&&(r=new Date);g=m.cssIcon?'<i class="'+m.cssIcon+" "+e.css.icon+'"></i>':"";m.$headers=f(a).find(m.selectorHeaders).each(function(a){h=f(this);d=m.headers[a];m.headerContent[a]=f(this).html(); k=m.headerTemplate.replace(/\{content\}/g,f(this).html()).replace(/\{icon\}/g,g);m.onRenderTemplate&&(x=m.onRenderTemplate.apply(h,[a,k]))&&"string"===typeof x&&(k=x);f(this).html('<div class="tablesorter-header-inner">'+k+"</div>");m.onRenderHeader&&m.onRenderHeader.apply(h,[a]);this.column=b[this.parentNode.rowIndex+"-"+this.cellIndex];var c=e.getData(h,d,"sortInitialOrder")||m.sortInitialOrder;this.order=/^d/i.test(c)||1===c?[1,0,2]:[0,1,2];this.count=-1;this.lockedOrder=!1;q=e.getData(h,d,"lockedOrder")|| !1;"undefined"!==typeof q&&!1!==q&&(this.order=this.lockedOrder=/^d/i.test(q)||1===q?[1,1,1]:[0,0,0]);h.addClass(e.css.header+" "+m.cssHeader);m.headerList[a]=this;h.parent().addClass(e.css.headerRow+" "+m.cssHeaderRow);h.attr("tabindex",0)});D(a);m.debug&&(n("Built headers:",r),c(m.$headers))}function F(a,b,d){var h=a.config;h.$table.find(h.selectorRemove).remove();w(a);z(a);G(h.$table,b,d)}function D(a){var b,d=a.config;d.$headers.each(function(a,c){b="false"===e.getData(c,d.headers[a],"sorter"); c.sortDisabled=b;f(c)[b?"addClass":"removeClass"]("sorter-false")})}function H(a){var b,d,h,c=a.config,g=c.sortList,k=[e.css.sortAsc+" "+c.cssAsc,e.css.sortDesc+" "+c.cssDesc],q=f(a).find("tfoot tr").children().removeClass(k.join(" "));c.$headers.removeClass(k.join(" "));h=g.length;for(b=0;b<h;b++)if(2!==g[b][1]&&(a=c.$headers.not(".sorter-false").filter('[data-column="'+g[b][0]+'"]'+(1===h?":last":"")),a.length))for(d=0;d<a.length;d++)a[d].sortDisabled||(a.eq(d).addClass(k[g[b][1]]),q.length&&q.filter('[data-column="'+ g[b][0]+'"]').eq(d).addClass(k[g[b][1]]))}function L(a){if(a.config.widthFixed&&0===f(a).find("colgroup").length){var b=f("<colgroup>"),d=f(a).width();f(a.tBodies[0]).find("tr:first").children("td:visible").each(function(){b.append(f("<col>").css("width",parseInt(f(this).width()/d*1E3,10)/10+"%"))});f(a).prepend(b)}}function M(a,b){var d,h,c,g=a.config,k=b||g.sortList;g.sortList=[];f.each(k,function(a,b){d=[parseInt(b[0],10),parseInt(b[1],10)];if(c=g.$headers[d[0]])g.sortList.push(d),h=f.inArray(d[1], c.order),c.count=0<=h?h:d[1]%(g.sortReset?3:2)})}function N(a,b,d){var h,c,g,k=a.config,q=!d[k.sortMultiSortKey],l=f(a);l.trigger("sortStart",a);b.count=d[k.sortResetKey]?2:(b.count+1)%(k.sortReset?3:2);k.sortRestart&&(c=b,k.$headers.each(function(){this===c||!q&&f(this).is("."+e.css.sortDesc+",."+e.css.sortAsc)||(this.count=-1)}));c=b.column;if(q){k.sortList=[];if(null!==k.sortForce)for(h=k.sortForce,d=0;d<h.length;d++)h[d][0]!==c&&k.sortList.push(h[d]);h=b.order[b.count];if(2>h&&(k.sortList.push([c, h]),1<b.colSpan))for(d=1;d<b.colSpan;d++)k.sortList.push([c+d,h])}else if(k.sortAppend&&1<k.sortList.length&&e.isValueInArray(k.sortAppend[0][0],k.sortList)&&k.sortList.pop(),e.isValueInArray(c,k.sortList))for(d=0;d<k.sortList.length;d++)g=k.sortList[d],h=k.$headers[g[0]],g[0]===c&&(g[1]=h.order[b.count],2===g[1]&&(k.sortList.splice(d,1),h.count=-1));else if(h=b.order[b.count],2>h&&(k.sortList.push([c,h]),1<b.colSpan))for(d=1;d<b.colSpan;d++)k.sortList.push([c+d,h]);if(null!==k.sortAppend)for(h=k.sortAppend, d=0;d<h.length;d++)h[d][0]!==c&&k.sortList.push(h[d]);l.trigger("sortBegin",a);setTimeout(function(){H(a);I(a);B(a)},1)}function I(a){var b,d,h,c,g,k,f,r,m,p,u,t,y,v=0,s=a.config,w=s.textSorter||"",z=s.sortList,B=z.length,C=a.tBodies.length;if(!s.serverSideSorting&&!l(s.cache)){s.debug&&(p=new Date);for(d=0;d<C;d++)k=s.cache[d].colMax,m=(f=s.cache[d].normalized)&&f[0]?f[0].length-1:0,f.sort(function(d,f){for(b=0;b<B;b++){g=z[b][0];r=z[b][1];t=(v=0===r)?d:f;y=v?f:d;h=s.string[s.empties[g]||s.emptyTo]; if(""===t[g]&&0!==h)return("boolean"===typeof h?h?-1:1:h||1)*(v?1:-1);if(""===y[g]&&0!==h)return("boolean"===typeof h?h?1:-1:-h||-1)*(v?1:-1);(c=/n/i.test(s.parsers&&s.parsers[g]?s.parsers[g].type||"":""))&&s.strings[g]?(c="boolean"===typeof s.string[s.strings[g]]?(v?1:-1)*(s.string[s.strings[g]]?-1:1):s.strings[g]?s.string[s.strings[g]]||0:0,u=s.numberSorter?s.numberSorter(t[g],y[g],v,k[g],a):e.sortNumeric(t[g],y[g],c,k[g])):u="function"===typeof w?w(t[g],y[g],v,g,a):"object"===typeof w&&w.hasOwnProperty(g)? w[g](t[g],y[g],v,g,a):e.sortNatural(t[g],y[g]);if(u)return u}return d[m]-f[m]});s.debug&&n("Sorting on "+z.toString()+" and dir "+r+" time",p)}}function J(a,b){var d=a[0].config;d.pager&&!d.pager.ajax&&a.trigger("updateComplete");"function"===typeof b&&b(a[0])}function G(a,b,d){!1===b||a[0].isProcessing?J(a,d):a.trigger("sorton",[a[0].config.sortList,function(){J(a,d)}])}function K(a){var b=a.config,d=b.$table,c,x;b.$headers.find(b.selectorSort).add(b.$headers.filter(b.selectorSort)).unbind("mousedown.tablesorter mouseup.tablesorter sort.tablesorter keypress.tablesorter").bind("mousedown.tablesorter mouseup.tablesorter sort.tablesorter keypress.tablesorter", function(d,c){if(!(1!==(d.which||d.button)&&!/sort|keypress/.test(d.type)||"keypress"===d.type&&13!==d.which||"mouseup"===d.type&&!0!==c&&250<(new Date).getTime()-x)){if("mousedown"===d.type)return x=(new Date).getTime(),"INPUT"===d.target.tagName?"":!b.cancelSelection;b.delayInit&&l(b.cache)&&z(a);var h=(/TH|TD/.test(this.tagName)?f(this):f(this).parents("th, td").filter(":first"))[0];h.sortDisabled||N(a,h,d)}});b.cancelSelection&&b.$headers.attr("unselectable","on").bind("selectstart",!1).css({"user-select":"none", MozUserSelect:"none"});d.unbind("sortReset update updateRows updateCell updateAll addRows sorton appendCache applyWidgetId applyWidgets refreshWidgets destroy mouseup mouseleave ".split(" ").join(".tablesorter ")).bind("sortReset.tablesorter",function(d){d.stopPropagation();b.sortList=[];H(a);I(a);B(a)}).bind("updateAll.tablesorter",function(b,d,c){b.stopPropagation();e.refreshWidgets(a,!0,!0);e.restoreHeaders(a);C(a);K(a);F(a,d,c)}).bind("update.tablesorter updateRows.tablesorter",function(b,d,c){b.stopPropagation(); D(a);F(a,d,c)}).bind("updateCell.tablesorter",function(c,h,e,l){c.stopPropagation();d.find(b.selectorRemove).remove();var m,x,n;m=d.find("tbody");c=m.index(f(h).parents("tbody").filter(":first"));var t=f(h).parents("tr").filter(":first");h=f(h)[0];m.length&&0<=c&&(x=m.eq(c).find("tr").index(t),n=h.cellIndex,m=b.cache[c].normalized[x].length-1,b.cache[c].row[a.config.cache[c].normalized[x][m]]=t,b.cache[c].normalized[x][n]=b.parsers[n].format(p(a,h,n),a,h,n),G(d,e,l))}).bind("addRows.tablesorter", function(g,e,f,x){g.stopPropagation();var m=e.filter("tr").length,l=[],n=e[0].cells.length,t=d.find("tbody").index(e.parents("tbody").filter(":first"));b.parsers||w(a);for(g=0;g<m;g++){for(c=0;c<n;c++)l[c]=b.parsers[c].format(p(a,e[g].cells[c],c),a,e[g].cells[c],c);l.push(b.cache[t].row.length);b.cache[t].row.push([e[g]]);b.cache[t].normalized.push(l);l=[]}G(d,f,x)}).bind("sorton.tablesorter",function(b,c,h,e){var f=a.config;b.stopPropagation();d.trigger("sortStart",this);M(a,c);H(a);f.delayInit&& l(f.cache)&&z(a);d.trigger("sortBegin",this);I(a);B(a,e);"function"===typeof h&&h(a)}).bind("appendCache.tablesorter",function(b,d,c){b.stopPropagation();B(a,c);"function"===typeof d&&d(a)}).bind("applyWidgetId.tablesorter",function(d,c){d.stopPropagation();e.getWidgetById(c).format(a,b,b.widgetOptions)}).bind("applyWidgets.tablesorter",function(b,d){b.stopPropagation();e.applyWidget(a,d)}).bind("refreshWidgets.tablesorter",function(b,d,c){b.stopPropagation();e.refreshWidgets(a,d,c)}).bind("destroy.tablesorter", function(b,d,c){b.stopPropagation();e.destroy(a,d,c)})}var e=this;e.version="2.13.3";e.parsers=[];e.widgets=[];e.defaults={theme:"default",widthFixed:!1,showProcessing:!1,headerTemplate:"{content}",onRenderTemplate:null,onRenderHeader:null,cancelSelection:!0,dateFormat:"mmddyyyy",sortMultiSortKey:"shiftKey",sortResetKey:"ctrlKey",usNumberFormat:!0,delayInit:!1,serverSideSorting:!1,headers:{},ignoreCase:!0,sortForce:null,sortList:[],sortAppend:null,sortInitialOrder:"asc",sortLocaleCompare:!1,sortReset:!1, sortRestart:!1,emptyTo:"bottom",stringTo:"max",textExtraction:"simple",textSorter:null,numberSorter:null,widgets:[],widgetOptions:{zebra:["even","odd"]},initWidgets:!0,initialized:null,tableClass:"",cssAsc:"",cssDesc:"",cssHeader:"",cssHeaderRow:"",cssProcessing:"",cssChildRow:"tablesorter-childRow",cssIcon:"tablesorter-icon",cssInfoBlock:"tablesorter-infoOnly",selectorHeaders:"> thead th, > thead td",selectorSort:"th, td",selectorRemove:".remove-me",debug:!1,headerList:[],empties:{},strings:{},parsers:[]}; e.css={table:"tablesorter",childRow:"tablesorter-childRow",header:"tablesorter-header",headerRow:"tablesorter-headerRow",icon:"tablesorter-icon",info:"tablesorter-infoOnly",processing:"tablesorter-processing",sortAsc:"tablesorter-headerAsc",sortDesc:"tablesorter-headerDesc"};e.log=c;e.benchmark=n;e.construct=function(a){return this.each(function(){var b=f.extend(!0,{},e.defaults,a);!this.hasInitialized&&e.buildTable&&"TABLE"!==this.tagName&&e.buildTable(this,b);e.setup(this,b)})};e.setup=function(a, b){if(!a||!a.tHead||0===a.tBodies.length||!0===a.hasInitialized)return b.debug?c("stopping initialization! No table, thead, tbody or tablesorter has already been initialized"):"";var d="",h=f(a),l=f.metadata;a.hasInitialized=!1;a.isProcessing=!0;a.config=b;f.data(a,"tablesorter",b);b.debug&&f.data(a,"startoveralltimer",new Date);b.supportsTextContent="x"===f("<span>x</span>")[0].textContent;b.supportsDataObject=function(a){a[0]=parseInt(a[0],10);return 1<a[0]||1===a[0]&&4<=parseInt(a[1],10)}(f.fn.jquery.split(".")); b.string={max:1,min:-1,"max+":1,"max-":-1,zero:0,none:0,"null":0,top:!0,bottom:!1};/tablesorter\-/.test(h.attr("class"))||(d=""!==b.theme?" tablesorter-"+b.theme:"");b.$table=h.addClass(e.css.table+" "+b.tableClass+d);b.$tbodies=h.children("tbody:not(."+b.cssInfoBlock+")");b.widgetInit={};C(a);L(a);w(a);b.delayInit||z(a);K(a);b.supportsDataObject&&"undefined"!==typeof h.data().sortlist?b.sortList=h.data().sortlist:l&&h.metadata()&&h.metadata().sortlist&&(b.sortList=h.metadata().sortlist);e.applyWidget(a, !0);0<b.sortList.length?h.trigger("sorton",[b.sortList,{},!b.initWidgets]):b.initWidgets&&e.applyWidget(a);b.showProcessing&&h.unbind("sortBegin.tablesorter sortEnd.tablesorter").bind("sortBegin.tablesorter sortEnd.tablesorter",function(b){e.isProcessing(a,"sortBegin"===b.type)});a.hasInitialized=!0;a.isProcessing=!1;b.debug&&e.benchmark("Overall initialization time",f.data(a,"startoveralltimer"));h.trigger("tablesorter-initialized",a);"function"===typeof b.initialized&&b.initialized(a)};e.isProcessing= function(a,b,d){a=f(a);var c=a[0].config;a=d||a.find("."+e.css.header);b?(0<c.sortList.length&&(a=a.filter(function(){return this.sortDisabled?!1:e.isValueInArray(parseFloat(f(this).attr("data-column")),c.sortList)})),a.addClass(e.css.processing+" "+c.cssProcessing)):a.removeClass(e.css.processing+" "+c.cssProcessing)};e.processTbody=function(a,b,d){if(d)return a.isProcessing=!0,b.before('<span class="tablesorter-savemyplace"/>'),d=f.fn.detach?b.detach():b.remove();d=f(a).find("span.tablesorter-savemyplace"); b.insertAfter(d);d.remove();a.isProcessing=!1};e.clearTableBody=function(a){f(a)[0].config.$tbodies.empty()};e.restoreHeaders=function(a){var b=a.config;b.$table.find(b.selectorHeaders).each(function(a){f(this).find(".tablesorter-header-inner").length&&f(this).html(b.headerContent[a])})};e.destroy=function(a,b,d){a=f(a)[0];if(a.hasInitialized){e.refreshWidgets(a,!0,!0);var c=f(a),l=a.config,g=c.find("thead:first"),k=g.find("tr."+e.css.headerRow).removeClass(e.css.headerRow+" "+l.cssHeaderRow),n=c.find("tfoot:first > tr").children("th, td"); g.find("tr").not(k).remove();c.removeData("tablesorter").unbind("sortReset update updateAll updateRows updateCell addRows sorton appendCache applyWidgetId applyWidgets refreshWidgets destroy mouseup mouseleave keypress sortBegin sortEnd ".split(" ").join(".tablesorter "));l.$headers.add(n).removeClass([e.css.header,l.cssHeader,l.cssAsc,l.cssDesc,e.css.sortAsc,e.css.sortDesc].join(" ")).removeAttr("data-column");k.find(l.selectorSort).unbind("mousedown.tablesorter mouseup.tablesorter keypress.tablesorter"); e.restoreHeaders(a);!1!==b&&c.removeClass(e.css.table+" "+l.tableClass+" tablesorter-"+l.theme);a.hasInitialized=!1;"function"===typeof d&&d(a)}};e.regex={chunk:/(^([+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[0-9a-f]+$|\d+)/gi,hex:/^0x[0-9a-f]+$/i};e.sortNatural=function(a,b){if(a===b)return 0;var d,c,f,g,k,l;c=e.regex;if(c.hex.test(b)){d=parseInt(a.match(c.hex),16);f=parseInt(b.match(c.hex),16);if(d<f)return-1;if(d>f)return 1}d=a.replace(c.chunk,"\\0$1\\0").replace(/\\0$/,"").replace(/^\\0/, "").split("\\0");c=b.replace(c.chunk,"\\0$1\\0").replace(/\\0$/,"").replace(/^\\0/,"").split("\\0");l=Math.max(d.length,c.length);for(k=0;k<l;k++){f=isNaN(d[k])?d[k]||0:parseFloat(d[k])||0;g=isNaN(c[k])?c[k]||0:parseFloat(c[k])||0;if(isNaN(f)!==isNaN(g))return isNaN(f)?1:-1;typeof f!==typeof g&&(f+="",g+="");if(f<g)return-1;if(f>g)return 1}return 0};e.sortText=function(a,b){return a>b?1:a<b?-1:0};e.getTextValue=function(a,b,d){if(d){var c=a?a.length:0,e=d+b;for(d=0;d<c;d++)e+=a.charCodeAt(d);return b* e}return 0};e.sortNumeric=function(a,b,d,c){if(a===b)return 0;isNaN(a)&&(a=e.getTextValue(a,d,c));isNaN(b)&&(b=e.getTextValue(b,d,c));return a-b};e.characterEquivalents={a:"\u00e1\u00e0\u00e2\u00e3\u00e4\u0105\u00e5",A:"\u00c1\u00c0\u00c2\u00c3\u00c4\u0104\u00c5",c:"\u00e7\u0107\u010d",C:"\u00c7\u0106\u010c",e:"\u00e9\u00e8\u00ea\u00eb\u011b\u0119",E:"\u00c9\u00c8\u00ca\u00cb\u011a\u0118",i:"\u00ed\u00ec\u0130\u00ee\u00ef\u0131",I:"\u00cd\u00cc\u0130\u00ce\u00cf",o:"\u00f3\u00f2\u00f4\u00f5\u00f6", O:"\u00d3\u00d2\u00d4\u00d5\u00d6",ss:"\u00df",SS:"\u1e9e",u:"\u00fa\u00f9\u00fb\u00fc\u016f",U:"\u00da\u00d9\u00db\u00dc\u016e"};e.replaceAccents=function(a){var b,d="[",c=e.characterEquivalents;if(!e.characterRegex){e.characterRegexArray={};for(b in c)"string"===typeof b&&(d+=c[b],e.characterRegexArray[b]=RegExp("["+c[b]+"]","g"));e.characterRegex=RegExp(d+"]")}if(e.characterRegex.test(a))for(b in c)"string"===typeof b&&(a=a.replace(e.characterRegexArray[b],b));return a};e.isValueInArray=function(a, b){var d,c=b.length;for(d=0;d<c;d++)if(b[d][0]===a)return!0;return!1};e.addParser=function(a){var b,d=e.parsers.length,c=!0;for(b=0;b<d;b++)e.parsers[b].id.toLowerCase()===a.id.toLowerCase()&&(c=!1);c&&e.parsers.push(a)};e.getParserById=function(a){var b,d=e.parsers.length;for(b=0;b<d;b++)if(e.parsers[b].id.toLowerCase()===a.toString().toLowerCase())return e.parsers[b];return!1};e.addWidget=function(a){e.widgets.push(a)};e.getWidgetById=function(a){var b,d,c=e.widgets.length;for(b=0;b<c;b++)if((d= e.widgets[b])&&d.hasOwnProperty("id")&&d.id.toLowerCase()===a.toLowerCase())return d};e.applyWidget=function(a,b){a=f(a)[0];var d=a.config,c=d.widgetOptions,l=[],g,k,q;d.debug&&(g=new Date);d.widgets.length&&(d.widgets=f.grep(d.widgets,function(a,b){return f.inArray(a,d.widgets)===b}),f.each(d.widgets||[],function(a,b){(q=e.getWidgetById(b))&&q.id&&(q.priority||(q.priority=10),l[a]=q)}),l.sort(function(a,b){return a.priority<b.priority?-1:a.priority===b.priority?0:1}),f.each(l,function(e,g){if(g){if(b|| !d.widgetInit[g.id])g.hasOwnProperty("options")&&(c=a.config.widgetOptions=f.extend(!0,{},g.options,c),d.widgetInit[g.id]=!0),g.hasOwnProperty("init")&&g.init(a,g,d,c);!b&&g.hasOwnProperty("format")&&g.format(a,d,c,!1)}}));d.debug&&(k=d.widgets.length,n("Completed "+(!0===b?"initializing ":"applying ")+k+" widget"+(1!==k?"s":""),g))};e.refreshWidgets=function(a,b,d){a=f(a)[0];var h,l=a.config,g=l.widgets,k=e.widgets,n=k.length;for(h=0;h<n;h++)k[h]&&k[h].id&&(b||0>f.inArray(k[h].id,g))&&(l.debug&& c("Refeshing widgets: Removing "+k[h].id),k[h].hasOwnProperty("remove")&&(k[h].remove(a,l,l.widgetOptions),l.widgetInit[k[h].id]=!1));!0!==d&&e.applyWidget(a,b)};e.getData=function(a,b,c){var e="";a=f(a);var l,g;if(!a.length)return"";l=f.metadata?a.metadata():!1;g=" "+(a.attr("class")||"");"undefined"!==typeof a.data(c)||"undefined"!==typeof a.data(c.toLowerCase())?e+=a.data(c)||a.data(c.toLowerCase()):l&&"undefined"!==typeof l[c]?e+=l[c]:b&&"undefined"!==typeof b[c]?e+=b[c]:" "!==g&&g.match(" "+ c+"-")&&(e=g.match(RegExp("\\s"+c+"-([\\w-]+)"))[1]||"");return f.trim(e)};e.formatFloat=function(a,b){if("string"!==typeof a||""===a)return a;var c;a=(b&&b.config?!1!==b.config.usNumberFormat:"undefined"!==typeof b?b:1)?a.replace(/,/g,""):a.replace(/[\s|\.]/g,"").replace(/,/g,".");/^\s*\([.\d]+\)/.test(a)&&(a=a.replace(/^\s*\(([.\d]+)\)/,"-$1"));c=parseFloat(a);return isNaN(c)?f.trim(a):c};e.isDigit=function(a){return isNaN(a)?/^[\-+(]?\d+[)]?$/.test(a.toString().replace(/[,.'"\s]/g,"")):!0}}}); var p=f.tablesorter;f.fn.extend({tablesorter:p.construct});p.addParser({id:"text",is:function(){return!0},format:function(c,n){var l=n.config;c&&(c=f.trim(l.ignoreCase?c.toLocaleLowerCase():c),c=l.sortLocaleCompare?p.replaceAccents(c):c);return c},type:"text"});p.addParser({id:"digit",is:function(c){return p.isDigit(c)},format:function(c,n){var l=p.formatFloat((c||"").replace(/[^\w,. \-()]/g,""),n);return c&&"number"===typeof l?l:c?f.trim(c&&n.config.ignoreCase?c.toLocaleLowerCase():c):c},type:"numeric"}); p.addParser({id:"currency",is:function(c){return/^\(?\d+[\u00a3$\u20ac\u00a4\u00a5\u00a2?.]|[\u00a3$\u20ac\u00a4\u00a5\u00a2?.]\d+\)?$/.test((c||"").replace(/[,. ]/g,""))},format:function(c,n){var l=p.formatFloat((c||"").replace(/[^\w,. \-()]/g,""),n);return c&&"number"===typeof l?l:c?f.trim(c&&n.config.ignoreCase?c.toLocaleLowerCase():c):c},type:"numeric"});p.addParser({id:"ipAddress",is:function(c){return/^\d{1,3}[\.]\d{1,3}[\.]\d{1,3}[\.]\d{1,3}$/.test(c)},format:function(c,f){var l,u=c?c.split("."): "",w="",z=u.length;for(l=0;l<z;l++)w+=("00"+u[l]).slice(-3);return c?p.formatFloat(w,f):c},type:"numeric"});p.addParser({id:"url",is:function(c){return/^(https?|ftp|file):\/\//.test(c)},format:function(c){return c?f.trim(c.replace(/(https?|ftp|file):\/\//,"")):c},type:"text"});p.addParser({id:"isoDate",is:function(c){return/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}/.test(c)},format:function(c,f){return c?p.formatFloat(""!==c?(new Date(c.replace(/-/g,"/"))).getTime()||"":"",f):c},type:"numeric"});p.addParser({id:"percent", is:function(c){return/(\d\s*?%|%\s*?\d)/.test(c)&&15>c.length},format:function(c,f){return c?p.formatFloat(c.replace(/%/g,""),f):c},type:"numeric"});p.addParser({id:"usLongDate",is:function(c){return/^[A-Z]{3,10}\.?\s+\d{1,2},?\s+(\d{4})(\s+\d{1,2}:\d{2}(:\d{2})?(\s+[AP]M)?)?$/i.test(c)||/^\d{1,2}\s+[A-Z]{3,10}\s+\d{4}/i.test(c)},format:function(c,f){return c?p.formatFloat((new Date(c.replace(/(\S)([AP]M)$/i,"$1 $2"))).getTime()||"",f):c},type:"numeric"});p.addParser({id:"shortDate",is:function(c){return/(^\d{1,2}[\/\s]\d{1,2}[\/\s]\d{4})|(^\d{4}[\/\s]\d{1,2}[\/\s]\d{1,2})/.test((c|| "").replace(/\s+/g," ").replace(/[\-.,]/g,"/"))},format:function(c,f,l,u){if(c){l=f.config;var w=l.headerList[u];u=w.dateFormat||p.getData(w,l.headers[u],"dateFormat")||l.dateFormat;c=c.replace(/\s+/g," ").replace(/[\-.,]/g,"/");"mmddyyyy"===u?c=c.replace(/(\d{1,2})[\/\s](\d{1,2})[\/\s](\d{4})/,"$3/$1/$2"):"ddmmyyyy"===u?c=c.replace(/(\d{1,2})[\/\s](\d{1,2})[\/\s](\d{4})/,"$3/$2/$1"):"yyyymmdd"===u&&(c=c.replace(/(\d{4})[\/\s](\d{1,2})[\/\s](\d{1,2})/,"$1/$2/$3"))}return c?p.formatFloat((new Date(c)).getTime()|| "",f):c},type:"numeric"});p.addParser({id:"time",is:function(c){return/^(([0-2]?\d:[0-5]\d)|([0-1]?\d:[0-5]\d\s?([AP]M)))$/i.test(c)},format:function(c,f){return c?p.formatFloat((new Date("2000/01/01 "+c.replace(/(\S)([AP]M)$/i,"$1 $2"))).getTime()||"",f):c},type:"numeric"});p.addParser({id:"metadata",is:function(){return!1},format:function(c,n,l){c=n.config;c=c.parserMetadataName?c.parserMetadataName:"sortValue";return f(l).metadata()[c]},type:"numeric"});p.addWidget({id:"zebra",priority:90,format:function(c, n,l){var u,w,z,B,E,C,F=RegExp(n.cssChildRow,"i"),D=n.$tbodies;n.debug&&(E=new Date);for(c=0;c<D.length;c++)u=D.eq(c),C=u.children("tr").length,1<C&&(z=0,u=u.children("tr:visible"),u.each(function(){w=f(this);F.test(this.className)||z++;B=0===z%2;w.removeClass(l.zebra[B?1:0]).addClass(l.zebra[B?0:1])}));n.debug&&p.benchmark("Applying Zebra widget",E)},remove:function(c,n,l){var p;n=n.$tbodies;var w=(l.zebra||["even","odd"]).join(" ");for(l=0;l<n.length;l++)p=f.tablesorter.processTbody(c,n.eq(l),!0), p.children().removeClass(w),f.tablesorter.processTbody(c,p,!1)}})})(jQuery);
    /*! tableSorter 2.8+ widgets - updated 11/9/2013 */
    ;(function(l){ var e=l.tablesorter=l.tablesorter||{};e.themes={bootstrap:{table:"table table-bordered table-striped",caption:"caption",header:"bootstrap-header",footerRow:"",footerCells:"",icons:"",sortNone:"bootstrap-icon-unsorted",sortAsc:"icon-chevron-up glyphicon glyphicon-chevron-up",sortDesc:"icon-chevron-down glyphicon glyphicon-chevron-down",active:"",hover:"",filterRow:"",even:"",odd:""},jui:{table:"ui-widget ui-widget-content ui-corner-all",caption:"ui-widget-content ui-corner-all",header:"ui-widget-header ui-corner-all ui-state-default", footerRow:"",footerCells:"",icons:"ui-icon",sortNone:"ui-icon-carat-2-n-s",sortAsc:"ui-icon-carat-1-n",sortDesc:"ui-icon-carat-1-s",active:"ui-state-active",hover:"ui-state-hover",filterRow:"",even:"ui-widget-content",odd:"ui-state-default"}};e.storage=function(b,a,c,d){var f,e=!1;f={};var h=b.config,n=d&&d.id||l(b).attr(d&&d.group||"data-table-group")||b.id||l(".tablesorter").index(l(b));d=d&&d.url||l(b).attr(d&&d.page||"data-table-page")||h&&h.fixedUrl||window.location.pathname;if("localStorage"in window)try{window.localStorage.setItem("_tmptest","temp"),e=!0,window.localStorage.removeItem("_tmptest")}catch(q){}l.parseJSON&&(e?f=l.parseJSON(localStorage[a]||"{}"):(f=document.cookie.split(/[;\s|=]/),b=l.inArray(a,f)+1,f=0!==b?l.parseJSON(f[b]||"{}"):{}));if((c||""===c)&&window.JSON&&JSON.hasOwnProperty("stringify"))f[d]||(f[d]={}),f[d][n]=c,e?localStorage[a]=JSON.stringify(f):(b=new Date,b.setTime(b.getTime()+31536E6),document.cookie=a+"="+JSON.stringify(f).replace(/\"/g,'"')+"; expires="+b.toGMTString()+ "; path=/");else return f&&f[d]?f[d][n]:{}};e.addHeaderResizeEvent=function(b,a,c){c=l.extend({},{timer:250},c);var d=b.config,f=d.widgetOptions,e,h=function(){f.resize_flag=!0;e=[];d.$headers.each(function(){var a=l.data(this,"savedSizes")||[0,0],b=this.offsetWidth,c=this.offsetHeight;if(b!==a[0]||c!==a[1])l.data(this,"savedSizes",[b,c]),e.push(this)});e.length&&d.$table.trigger("resize",[e]);f.resize_flag=!1};d.$headers.each(function(){l.data(this,"savedSizes",[this.offsetWidth,this.offsetHeight])}); clearInterval(f.resize_timer);if(a)return f.resize_flag=!1;f.resize_timer=setInterval(function(){f.resize_flag||h()},c.timer)};e.addWidget({id:"uitheme",priority:10,options:{uitheme:"jui"},format:function(b,a,c){var d,f,g,h,n=e.themes,q=a.$table,m="default"!==a.theme?a.theme:c.uitheme||"jui",k=n[n[m]?m:n[c.uitheme]?c.uitheme:"jui"],p=a.$headers,x="tr."+(c.stickyHeaders||"tablesorter-stickyHeader"),r=k.sortNone+" "+k.sortDesc+" "+k.sortAsc;a.debug&&(d=new Date);q.hasClass("tablesorter-"+m)&&a.theme!== m&&b.hasInitialized||(""!==k.even&&(c.zebra[0]+=" "+k.even),""!==k.odd&&(c.zebra[1]+=" "+k.odd),q.find("caption").addClass(k.caption),n=q.removeClass(""===a.theme?"":"tablesorter-"+a.theme).addClass("tablesorter-"+m+" "+k.table).find("tfoot"),n.length&&n.find("tr").addClass(k.footerRow).children("th, td").addClass(k.footerCells),p.addClass(k.header).filter(":not(.sorter-false)").bind("mouseenter.tsuitheme mouseleave.tsuitheme",function(a){l(this)["mouseenter"===a.type?"addClass":"removeClass"](k.hover)}), p.find(".tablesorter-wrapper").length||p.wrapInner('<div class="tablesorter-wrapper" style="position:relative;height:100%;width:100%"></div>'),a.cssIcon&&p.find("."+e.css.icon).addClass(k.icons),q.hasClass("hasFilters")&&p.find(".tablesorter-filter-row").addClass(k.filterRow));l.each(p,function(a){g=l(this);h=e.css.icon?g.find("."+e.css.icon):g;this.sortDisabled?(g.removeClass(r),h.removeClass(r+" tablesorter-icon "+k.icons)):(n=q.hasClass("hasStickyHeaders")?q.find(x).find("th").eq(a).add(g):g,f= g.hasClass(e.css.sortAsc)?k.sortAsc:g.hasClass(e.css.sortDesc)?k.sortDesc:g.hasClass(e.css.header)?k.sortNone:"",g[f===k.sortNone?"removeClass":"addClass"](k.active),h.removeClass(r).addClass(f))});a.debug&&e.benchmark("Applying "+m+" theme",d)},remove:function(b,a,c){b=a.$table;a="object"===typeof c.uitheme?"jui":c.uitheme||"jui";c="object"===typeof c.uitheme?c.uitheme:e.themes[e.themes.hasOwnProperty(a)?a:"jui"];var d=b.children("thead").children(),f=c.sortNone+" "+c.sortDesc+" "+c.sortAsc;b.removeClass("tablesorter-"+ a+" "+c.table).find(e.css.header).removeClass(c.header);d.unbind("mouseenter.tsuitheme mouseleave.tsuitheme").removeClass(c.hover+" "+f+" "+c.active).find(".tablesorter-filter-row").removeClass(c.filterRow);d.find(".tablesorter-icon").removeClass(c.icons)}});e.addWidget({id:"columns",priority:30,options:{columns:["primary","secondary","tertiary"]},format:function(b,a,c){var d,f,g,h,n,q,m,k,p,x=a.$table,r=a.$tbodies,s=a.sortList,u=s.length,w=a.widgetColumns&&a.widgetColumns.hasOwnProperty("css")?a.widgetColumns.css|| w:c&&c.hasOwnProperty("columns")?c.columns||w:w;q=w.length-1;m=w.join(" ");a.debug&&(n=new Date);for(p=0;p<r.length;p++)d=e.processTbody(b,r.eq(p),!0),f=d.children("tr"),f.each(function(){h=l(this);if("none"!==this.style.display&&(g=h.children().removeClass(m),s&&s[0]&&(g.eq(s[0][0]).addClass(w[0]),1<u)))for(k=1;k<u;k++)g.eq(s[k][0]).addClass(w[k]||w[q])}),e.processTbody(b,d,!1);f=!1!==c.columns_thead?["thead tr"]:[];!1!==c.columns_tfoot&&f.push("tfoot tr");if(f.length&&(h=x.find(f.join(",")).children().removeClass(m), u))for(k=0;k<u;k++)h.filter('[data-column="'+s[k][0]+'"]').addClass(w[k]||w[q]);a.debug&&e.benchmark("Applying Columns widget",n)},remove:function(b,a,c){var d=a.$tbodies,f=(c.columns||["primary","secondary","tertiary"]).join(" ");a.$headers.removeClass(f);a.$table.children("tfoot").children("tr").children("th, td").removeClass(f);for(a=0;a<d.length;a++)c=e.processTbody(b,d.eq(a),!0),c.children("tr").each(function(){l(this).children().removeClass(f)}),e.processTbody(b,c,!1)}});e.addWidget({id:"filter", priority:50,options:{filter_anyMatch:!1,filter_childRows:!1,filter_columnFilters:!0,filter_cssFilter:"",filter_filteredRow:"filtered",filter_formatter:null,filter_functions:null,filter_hideFilters:!1,filter_ignoreCase:!0,filter_liveSearch:!0,filter_onlyAvail:"filter-onlyAvail",filter_reset:null,filter_searchDelay:300,filter_startsWith:!1,filter_useParsedData:!1,filter_serversideFiltering:!1,filter_defaultAttrib:"data-value"},format:function(b,a,c){a.$table.hasClass("hasFilters")||(a.parsers||!a.parsers&& c.filter_serversideFiltering)&&e.filter.init(b,a,c)},remove:function(b,a,c){var d,f=a.$tbodies;a.$table.removeClass("hasFilters").unbind("addRows updateCell update updateComplete appendCache search filterStart filterEnd ".split(" ").join(".tsfilter ")).find(".tablesorter-filter-row").remove();for(a=0;a<f.length;a++)d=e.processTbody(b,f.eq(a),!0),d.children().removeClass(c.filter_filteredRow).show(),e.processTbody(b,d,!1);c.filter_reset&&l(document).undelegate(c.filter_reset,"click.tsfilter")}});e.filter= {regex:{regex:/^\/((?:\\\/|[^\/])+)\/([mig]{0,3})?$/,child:/tablesorter-childRow/,filtered:/filtered/,type:/undefined|number/,exact:/(^[\"|\'|=]+)|([\"|\'|=]+$)/g,nondigit:/[^\w,. \-()]/g,operators:/[<>=]/g},types:{regex:function(b,a,c,d){if(e.filter.regex.regex.test(a)){var f;b=e.filter.regex.regex.exec(a);try{f=RegExp(b[1],b[2]).test(d)}catch(g){f=!1}return f}return null},exact:function(b,a,c,d){return a.replace(e.filter.regex.exact,"")==d?!0:null},notMatch:function(b,a,c,d,f,e,h,n){return/^\!/.test(a)? (a=a.replace("!",""),b=d.search(l.trim(a)),""===a?!0:!(n.filter_startsWith?0===b:0<=b)):null},operators:function(b,a,c,d,f,g,h,l,q){if(/^[<>]=?/.test(a)){var m,k;m=h.config;b=e.formatFloat(a.replace(e.filter.regex.operators,""),h);c=m.parsers[g];l=b;if(q[g]||"numeric"===c.type)m=c.format(""+a.replace(e.filter.regex.operators,""),h,m.$headers.eq(g),g),b="number"!==typeof b||""===m||isNaN(m)?b:m;m=!q[g]&&"numeric"!==c.type||isNaN(b)||!f?isNaN(d)?e.formatFloat(d.replace(e.filter.regex.nondigit,""),h): e.formatFloat(d,h):f;/>/.test(a)&&(k=/>=/.test(a)?m>=b:m>b);/</.test(a)&&(k=/<=/.test(a)?m<=b:m<b);k||""!==l||(k=!0);return k}return null},and:function(b,a,c,d){if(/\s+(AND|&&)\s+/g.test(b)){b=a.split(/(?:\s+(?:and|&&)\s+)/g);a=0<=d.search(l.trim(b[0]));for(c=b.length-1;a&&c;)a=a&&0<=d.search(l.trim(b[c])),c--;return a}return null},range:function(b,a,c,d,f,g,h,l,q){if(/\s+(-|to)\s+/.test(a)){b=h.config;c=a.split(/(?: - | to )/);l=e.formatFloat(c[0].replace(e.filter.regex.nondigit,""),h);var m=e.formatFloat(c[1].replace(e.filter.regex.nondigit, ""),h);if(q[g]||"numeric"===b.parsers[g].type)a=b.parsers[g].format(""+c[0],h,b.$headers.eq(g),g),l=""===a||isNaN(a)?l:a,a=b.parsers[g].format(""+c[1],h,b.$headers.eq(g),g),m=""===a||isNaN(a)?m:a;a=!q[g]&&"numeric"!==b.parsers[g].type||isNaN(l)||isNaN(m)?isNaN(d)?e.formatFloat(d.replace(e.filter.regex.nondigit,""),h):e.formatFloat(d,h):f;l>m&&(a=l,l=m,m=a);return a>=l&&a<=m||""===l||""===m}return null},wild:function(b,a,c,d,f,e,h){return/[\?|\*]/.test(a)||/\s+OR\s+/.test(b)?(b=h.config,a=a.replace(/\s+OR\s+/gi, "|"),!b.$headers.filter('[data-column="'+e+'"]:last').hasClass("filter-match")&&/\|/.test(a)&&(a="^("+a+")$"),RegExp(a.replace(/\?/g,"\\S{1}").replace(/\*/g,"\\S*")).test(d)):null},fuzzy:function(b,a,c,d){if(/^~/.test(a)){b=0;c=d.length;var f=a.slice(1);for(a=0;a<c;a++)d[a]===f[b]&&(b+=1);return b===f.length?!0:!1}return null}},init:function(b,a,c){var d,f,g,h,n,q;a.debug&&(q=new Date);a.$table.addClass("hasFilters");e.filter.regex.child=RegExp(a.cssChildRow);e.filter.regex.filtered=RegExp(c.filter_filteredRow); !1!==c.filter_columnFilters&&a.$headers.filter(".filter-false").length!==a.$headers.length&&e.filter.buildRow(b,a,c);a.$table.bind("addRows updateCell update updateRows updateComplete appendCache filterReset filterEnd search ".split(" ").join(".tsfilter "),function(c,d){/(search|filterReset|filterEnd)/.test(c.type)||(c.stopPropagation(),e.filter.buildDefault(b,!0));"filterReset"===c.type&&e.filter.searching(b,[]);"filterEnd"===c.type?e.filter.buildDefault(b,!0):(d="search"===c.type?d:"updateComplete"=== c.type?a.$table.data("lastSearch"):"",e.filter.searching(b,d));return!1});e.filter.bindSearch(b,a.$table.find("input.tablesorter-filter"));c.filter_reset&&l(document).delegate(c.filter_reset,"click.tsfilter",function(){e.filter.searching(b,[])});if(c.filter_functions)for(h in c.filter_functions)if(c.filter_functions.hasOwnProperty(h)&&"string"===typeof h)if(g=a.$headers.filter('[data-column="'+h+'"]:last'),d="",!0===c.filter_functions[h]&&!g.hasClass("filter-false"))e.filter.buildSelect(h);else if("string"=== typeof h&&!g.hasClass("filter-false")){for(f in c.filter_functions[h])"string"===typeof f&&(d+=""===d?'<option value="">'+(g.data("placeholder")||g.attr("data-placeholder")||"")+"</option>":"",d+='<option value="'+f+'">'+f+"</option>");a.$table.find("thead").find('select.tablesorter-filter[data-column="'+h+'"]').append(d)}e.filter.buildDefault(b,!0);a.$table.find("select.tablesorter-filter").bind("change search",function(a,c){e.filter.checkFilters(b,c)});c.filter_hideFilters&&e.filter.hideFilters(b, a,c);a.showProcessing&&a.$table.bind("filterStart.tsfilter filterEnd.tsfilter",function(c,d){g=d?a.$table.find("."+e.css.header).filter("[data-column]").filter(function(){return""!==d[l(this).data("column")]}):"";e.isProcessing(b,"filterStart"===c.type,d?g:"")});a.debug&&e.benchmark("Applying Filter widget",q);a.$table.bind("tablesorter-initialized pagerInitialized",function(){n=e.filter.setDefaults(b,a,c)||[];n.length&&e.setFilters(b,n,!0)});c.filter_Initialized=!0;a.$table.trigger("filterInit"); e.filter.checkFilters(b)},setDefaults:function(b,a,c){var d,f=[],e=a.columns;for(d=0;d<e;d++)f[d]=a.$headers.filter('[data-column="'+d+'"]:last').attr(c.filter_defaultAttrib)||f[d];l(b).data("lastSearch",f);return f},buildRow:function(b,a,c){var d,f,g,h=a.columns;f='<tr class="tablesorter-filter-row">';for(b=0;b<h;b++)f+="<td></td>";a.$filters=l(f+"</tr>").appendTo(a.$table.find("thead").eq(0)).find("td");for(b=0;b<h;b++)d=a.$headers.filter('[data-column="'+b+'"]:last'),f=c.filter_functions&&c.filter_functions[b]&& "function"!==typeof c.filter_functions[b]||d.hasClass("filter-select"),g=e.getData?"false"===e.getData(d[0],a.headers[b],"filter"):a.headers[b]&&a.headers[b].hasOwnProperty("filter")&&!1===a.headers[b].filter||d.hasClass("filter-false"),f?f=l("<select>").appendTo(a.$filters.eq(b)):(c.filter_formatter&&l.isFunction(c.filter_formatter[b])?((f=c.filter_formatter[b](a.$filters.eq(b),b))&&0===f.length&&(f=a.$filters.eq(b).children("input")),f&&(0===f.parent().length||f.parent().length&&f.parent()[0]!== a.$filters[b])&&a.$filters.eq(b).append(f)):f=l('<input type="search">').appendTo(a.$filters.eq(b)),f&&f.attr("placeholder",d.data("placeholder")||d.attr("data-placeholder")||"")),f&&(f.addClass("tablesorter-filter "+c.filter_cssFilter).attr("data-column",b),g&&(f.addClass("disabled")[0].disabled=!0))},bindSearch:function(b,a){b=l(b)[0];var c,d=b.config.widgetOptions;a.bind("keyup search",function(a,g){if(27===a.which)this.value="";else if("number"===typeof d.filter_liveSearch&&this.value.length< d.filter_liveSearch&&""!==this.value||"keyup"===a.type&&(32>a.which&&8!==a.which&&!0===d.filter_liveSearch&&13!==a.which||37<=a.which&&40>=a.which||13!==a.which&&!1===d.filter_liveSearch))return;c=l(this).hasClass("tablesorter-filter")?g:[l(this).val()];e.filter.searching(b,g,c)})},checkFilters:function(b,a){var c=b.config,d=c.widgetOptions,f=l.isArray(a),g=f?a:e.getFilters(b),h=(g||[]).join("");f&&e.setFilters(b,g);d.filter_hideFilters&&c.$table.find(".tablesorter-filter-row").trigger(""===h?"mouseleave": "mouseenter");if(c.lastCombinedFilter!==h||!1===a)if(c.$table.trigger("filterStart",[g]),c.showProcessing)setTimeout(function(){e.filter.findRows(b,g,h);return!1},30);else return e.filter.findRows(b,g,h),!1},hideFilters:function(b,a,c){var d,f,g;a.$table.find(".tablesorter-filter-row").addClass("hideme").bind("mouseenter mouseleave",function(a){d=l(this);clearTimeout(g);g=setTimeout(function(){/enter|over/.test(a.type)?d.removeClass("hideme"):l(document.activeElement).closest("tr")[0]!==d[0]&&""=== e.getFilters(b).join("")&&d.addClass("hideme")},200)}).find("input, select").bind("focus blur",function(a){f=l(this).closest("tr");clearTimeout(g);g=setTimeout(function(){if(""===e.getFilters(b).join(""))f["focus"===a.type?"removeClass":"addClass"]("hideme")},200)})},findRows:function(b,a,c){var d,f,g,h,n,q,m,k,p,x,r,s,u,w,y,A,B,C,z,E,v=b.config,t=v.widgetOptions,G=v.columns,D=v.$tbodies,H=["range","operators"],F=v.$headers.map(function(a){return e.getData?"parsed"===e.getData(v.$headers.filter('[data-column="'+ a+'"]:last'),v.headers[a],"filter"):l(this).hasClass("filter-parsed")}).get();v.debug&&(E=new Date);for(n=0;n<D.length;n++)if(!D.eq(n).hasClass(e.css.info)){q=e.processTbody(b,D.eq(n),!0);g=q.children("tr").not("."+v.cssChildRow);f=g.length;if(""===c||t.filter_serversideFiltering)q.children().show().removeClass(t.filter_filteredRow);else for(B=!0,w=v.lastSearch||v.$table.data("lastSearch")||[],l.each(a,function(a,b){B=0===(b||"").indexOf(w[a]||"")&&B&&!/(\s+or\s+|\|)/g.test(b||"")}),B&&0===g.filter(":visible").length&& (B=!1),h=0;h<f;h++)if(p=g[h].className,!(e.filter.regex.child.test(p)||B&&e.filter.regex.filtered.test(p))){z=!0;p=g.eq(h).nextUntil("tr:not(."+v.cssChildRow+")");x=p.length&&t.filter_childRows?p.text():"";x=t.filter_ignoreCase?x.toLocaleLowerCase():x;m=g.eq(h).children("td");for(k=0;k<G;k++)if(a[k]||t.filter_anyMatch){d=v.cache[n].normalized[h][k];t.filter_useParsedData||F[k]?r=d:(r=l.trim(m.eq(k).text()),r=v.sortLocaleCompare?e.replaceAccents(r):r);s=!e.filter.regex.type.test(typeof r)&&t.filter_ignoreCase? r.toLocaleLowerCase():r;A=z;if("undefined"===typeof a[k]||null===a[k])a[k]=t.filter_anyMatch?c:a[k];a[k]=v.sortLocaleCompare?e.replaceAccents(a[k]):a[k];u=t.filter_ignoreCase?a[k].toLocaleLowerCase():a[k];t.filter_functions&&t.filter_functions[k]?!0===t.filter_functions[k]?A=v.$headers.filter('[data-column="'+k+'"]:last').hasClass("filter-match")?0<=s.search(u):a[k]===r:"function"===typeof t.filter_functions[k]?A=t.filter_functions[k](r,d,a[k],k,g.eq(h)):"function"===typeof t.filter_functions[k][a[k]]&& (A=t.filter_functions[k][a[k]](r,d,a[k],k,g.eq(h))):(C=null,l.each(e.filter.types,function(c,e){if(!t.filter_anyMatch||t.filter_anyMatch&&0>H.indexOf(c))if(y=e(a[k],u,r,s,d,k,b,t,F),null!==y)return C=y,!1}),null!==C?A=C:(r=(s+x).indexOf(u),A=!t.filter_startsWith&&0<=r||t.filter_startsWith&&0===r));if(t.filter_anyMatch){if(z=A)break}else z=A?z:!1}g[h].style.display=z?"":"none";g.eq(h)[z?"removeClass":"addClass"](t.filter_filteredRow);if(p.length){if(v.pager&&v.pager.countChildRows||t.pager_countChildRows)p[z? "removeClass":"addClass"](t.filter_filteredRow);p.toggle(z)}}e.processTbody(b,q,!1)}v.lastCombinedFilter=c;v.lastSearch=a;v.$table.data("lastSearch",a);v.debug&&e.benchmark("Completed filter widget search",E);v.$table.trigger("applyWidgets");v.$table.trigger("filterEnd")},buildSelect:function(b,a,c,d){a=parseInt(a,10);var f,g,h;b=b.config;var n=b.widgetOptions,q=b.$tbodies,m=[],k=b.$headers.filter('[data-column="'+a+'"]:last'),p='<option value="">'+(k.data("placeholder")||k.attr("data-placeholder")|| "")+"</option>";for(g=0;g<q.length;g++)for(h=b.cache[g].row.length,f=0;f<h;f++)d&&b.cache[g].row[f][0].className.match(n.filter_filteredRow)||(n.filter_useParsedData?m.push(""+b.cache[g].normalized[f][a]):(k=b.cache[g].row[f][0].cells[a])&&m.push(l.trim(k.textContent||k.innerText||l(k).text())));m=l.grep(m,function(a,b){return l.inArray(a,m)===b});m=e.sortNatural?m.sort(function(a,b){return e.sortNatural(a,b)}):m.sort(!0);f=b.$table.find("thead").find('select.tablesorter-filter[data-column="'+a+'"]').val(); for(d=0;d<m.length;d++)g=m[d].replace(/\"/g,"&quot;"),p+=""!==m[d]?'<option value="'+g+'"'+(f===g?' selected="selected"':"")+">"+m[d]+"</option>":"";b.$table.find("thead").find('select.tablesorter-filter[data-column="'+a+'"]')[c?"html":"append"](p)},buildDefault:function(b,a){var c,d,f=b.config,g=f.widgetOptions,h=f.columns;for(c=0;c<h;c++)d=f.$headers.filter('[data-column="'+c+'"]:last'),(d.hasClass("filter-select")||g.filter_functions&&!0===g.filter_functions[c])&&!d.hasClass("filter-false")&&(g.filter_functions|| (g.filter_functions={}),g.filter_functions[c]=!0,e.filter.buildSelect(b,c,a,d.hasClass(g.filter_onlyAvail)))},searching:function(b,a,c){if("undefined"===typeof a||!0===a||c){var d=b.config.widgetOptions;clearTimeout(d.searchTimer);d.searchTimer=setTimeout(function(){e.filter.checkFilters(b,c||a)},d.filter_liveSearch?d.filter_searchDelay:10)}else e.filter.checkFilters(b,a)}};e.getFilters=function(b){var a=b?l(b)[0].config:{};return a&&a.widgetOptions&&!a.widgetOptions.filter_columnFilters?l(b).data("lastSearch"): a&&a.$filters?a.$filters.map(function(a,b){return l(b).find(".tablesorter-filter").val()||""}).get()||[]:!1};e.setFilters=function(b,a,c){b=l(b);var d=b.length?b[0].config:{},d=d&&d.$filters?d.$filters.each(function(b,c){l(c).find(".tablesorter-filter").val(a[b]||"")}).trigger("change.tsfilter")||!1:!1;c&&b.trigger("search",[a,!1]);return!!d};e.addWidget({id:"stickyHeaders",priority:60,options:{stickyHeaders:"",stickyHeaders_offset:0,stickyHeaders_cloneId:"-sticky",stickyHeaders_addResizeEvent:!0, stickyHeaders_includeCaption:!0,stickyHeaders_zIndex:2},format:function(b,a,c){if(!a.$table.hasClass("hasStickyHeaders")){var d=a.$table,f=l(window),g=d.children("thead:first"),h=g.children("tr:not(.sticky-false)").children(),n=d.find("tfoot"),q=isNaN(c.stickyHeaders_offset)?l(c.stickyHeaders_offset):"",m=q.length?q.height()||0:parseInt(c.stickyHeaders_offset,10)||0,k=c.stickyHeaders_zIndex?c.stickyHeaders_zIndex:2,p=c.$sticky=d.clone().addClass("containsStickyHeaders").css({position:"fixed",margin:0, top:m,visibility:"hidden",zIndex:k}),x=p.children("thead:first").addClass("tablesorter-stickyHeader "+c.stickyHeaders),r,s="",u=0,w=!1,y=function(){m=q.length?q.height()||0:parseInt(c.stickyHeaders_offset,10)||0;var a=navigator.userAgent;u=0;"collapse"===d.css("border-collapse")||/(webkit|msie)/i.test(a)||(u=2*parseInt(h.eq(0).css("border-left-width"),10));p.css({left:g.offset().left-f.scrollLeft()-u,width:d.width()});r.filter(":visible").each(function(a){a=h.filter(":visible").eq(a);l(this).css({width:a.width()- u,height:a.height()}).find(".tablesorter-header-inner").width(a.find(".tablesorter-header-inner").width())})};p.attr("id")&&(p[0].id+=c.stickyHeaders_cloneId);p.find("thead:gt(0), tr.sticky-false, tbody, tfoot").remove();c.stickyHeaders_includeCaption||p.find("caption").remove();r=x.children().children();p.css({height:0,width:0,padding:0,margin:0,border:0});r.find(".tablesorter-resizer").remove();d.addClass("hasStickyHeaders").bind("sortEnd.tsSticky",function(){h.filter(":visible").each(function(b){b= r.filter(":visible").eq(b);b.attr("class",l(this).attr("class")).removeClass(e.css.processing+" "+a.cssProcessing);a.cssIcon&&b.find("."+e.css.icon).attr("class",l(this).find("."+e.css.icon).attr("class"))})}).bind("pagerComplete.tsSticky",function(){y()});h.find(a.selectorSort).add(a.$headers.filter(a.selectorSort)).each(function(b){var c=l(this);b=x.children("tr.tablesorter-headerRow").children().eq(b).bind("mouseup",function(a){c.trigger(a,!0)});a.cancelSelection&&b.attr("unselectable","on").bind("selectstart", !1).css({"user-select":"none",MozUserSelect:"none"})});d.after(p);f.bind("scroll.tsSticky resize.tsSticky",function(a){if(d.is(":visible")){var b=d.offset(),e=c.stickyHeaders_includeCaption?0:d.find("caption").outerHeight(!0),e=f.scrollTop()+m-e,h=d.height()-(p.height()+(n.height()||0)),b=e>b.top&&e<b.top+h?"visible":"hidden";p.removeClass("tablesorter-sticky-visible tablesorter-sticky-hidden").addClass("tablesorter-sticky-"+b).css({left:g.offset().left-f.scrollLeft()-u,visibility:b});if(b!==s||"resize"=== a.type)y(),s=b}});c.stickyHeaders_addResizeEvent&&e.addHeaderResizeEvent(b);d.bind("filterEnd",function(){w||x.find(".tablesorter-filter-row").children().each(function(b){l(this).find(".tablesorter-filter").val(a.$filters.find(".tablesorter-filter").eq(b).val())})});r.find(".tablesorter-filter").bind("keyup search change",function(b){if(!(32>b.which&&8!==b.which||37<=b.which&&40>=b.which)){w=!0;b=l(this);var d=b.attr("data-column");a.$filters.find(".tablesorter-filter").eq(d).val(b.val()).trigger("search"); setTimeout(function(){w=!1},c.filter_searchDelay)}});d.trigger("stickyHeadersInit")}},remove:function(b,a,c){a.$table.removeClass("hasStickyHeaders").unbind("sortEnd.tsSticky pagerComplete.tsSticky").find(".tablesorter-stickyHeader").remove();c.$sticky&&c.$sticky.length&&c.$sticky.remove();l(".hasStickyHeaders").length||l(window).unbind("scroll.tsSticky resize.tsSticky");e.addHeaderResizeEvent(b,!1)}});    e.addWidget({id:"resizable",priority:40,options:{resizable:!0,resizable_addLastColumn:!1},format:function(b, a,c){if(!a.$table.hasClass("hasResizable")){a.$table.addClass("hasResizable");var d,f,g,h,n={},q,m,k,p,x=a.$table,r=0,s=null,u=null,w=20>Math.abs(x.parent().width()-x.width()),y=function(){e.storage&&s&&(n[s.index()]=s.width(),n[u.index()]=u.width(),s.width(n[s.index()]),u.width(n[u.index()]),!1!==c.resizable&&e.storage(b,"tablesorter-resizable",n));r=0;s=u=null;l(window).trigger("resize")};if(n=e.storage&&!1!==c.resizable?e.storage(b,"tablesorter-resizable"):{})for(h in n)!isNaN(h)&&h<a.$headers.length&& a.$headers.eq(h).width(n[h]);d=x.children("thead:first").children("tr");d.children().each(function(){f=l(this);g=f.attr("data-column");h="false"===e.getData(f,a.headers[g],"resizable");d.children().filter('[data-column="'+g+'"]').toggleClass("resizable-false",h)});d.each(function(){q=l(this).children(":not(.resizable-false)");l(this).find(".tablesorter-wrapper").length||q.wrapInner('<div class="tablesorter-wrapper" style="position:relative;height:100%;width:100%"></div>');c.resizable_addLastColumn|| (q=q.slice(0,-1));m=m?m.add(q):q});m.each(function(){d=l(this);h=parseInt(d.css("padding-right"),10)+10;f='<div class="tablesorter-resizer" style="cursor:w-resize;position:absolute;z-index:1;right:-'+h+'px;top:0;height:100%;width:20px;"></div>';d.find(".tablesorter-wrapper").append(f)}).bind("mousemove.tsresize",function(a){0!==r&&s&&(k=a.pageX-r,p=s.width(),s.width(p+k),s.width()!==p&&w&&u.width(u.width()-k),r=a.pageX)}).bind("mouseup.tsresize",function(){y()}).find(".tablesorter-resizer,.tablesorter-resizer-grip").bind("mousedown", function(b){s=l(b.target).closest("th");f=a.$headers.filter('[data-column="'+s.attr("data-column")+'"]');1<f.length&&(s=s.add(f));u=b.shiftKey?s.parent().find("th:not(.resizable-false)").filter(":last"):s.nextAll(":not(.resizable-false)").eq(0);r=b.pageX});x.find("thead:first").bind("mouseup.tsresize mouseleave.tsresize",function(){y()}).bind("contextmenu.tsresize",function(){e.resizableReset(b);var a=l.isEmptyObject?l.isEmptyObject(n):n==={};n={};return a})}},remove:function(b,a,c){a.$table.removeClass("hasResizable").find("thead").unbind("mouseup.tsresize mouseleave.tsresize contextmenu.tsresize").find("tr").children().unbind("mousemove.tsresize mouseup.tsresize").find(".tablesorter-resizer,.tablesorter-resizer-grip").remove(); e.resizableReset(b)}});    e.resizableReset=function(b){b.config.$headers.filter(":not(.resizable-false)").css("width","");e.storage&&e.storage(b,"tablesorter-resizable",{})};    e.addWidget({id:"saveSort",priority:20,options:{saveSort:!0},init:function(b,a,c,d){a.format(b,c,d,!0)},format:function(b,a,c,d){var f,g=a.$table;c=!1!==c.saveSort;var h={sortList:a.sortList};a.debug&&(f=new Date);g.hasClass("hasSaveSort")?c&&b.hasInitialized&&e.storage&&(e.storage(b,"tablesorter-savesort",h),a.debug&&e.benchmark("saveSort widget: Saving last sort: "+ a.sortList,f)):(g.addClass("hasSaveSort"),h="",e.storage&&(h=(c=e.storage(b,"tablesorter-savesort"))&&c.hasOwnProperty("sortList")&&l.isArray(c.sortList)?c.sortList:"",a.debug&&e.benchmark('saveSort: Last sort loaded: "'+h+'"',f),g.bind("saveSortReset",function(a){a.stopPropagation();e.storage(b,"tablesorter-savesort","")})),d&&h&&0<h.length?a.sortList=h:b.hasInitialized&&h&&0<h.length&&g.trigger("sorton",[h]))},remove:function(b){e.storage&&e.storage(b,"tablesorter-savesort","")}})    })(jQuery);
    /******* end of libraries *******/
      
    var debug = false;
    
    var prevLast;
    var count = 0;      
    
    init();
    loadApps(function() {        
      appsLoaded();    
    });

    /** do before starting to load app list */
    function init() {    
      /* add loading ui */
      $('body').prepend('<div class="loaders" id="loading" style="position:fixed; right:20px; top: 15px; z-index: 9999;"><img src="http://img.cdn.tl/loading31.gif" /></div>');    
      $('body').prepend(
        '<div class="loaders" id="fullscreenblock" style="background-color:rgba(255,255,255,0.8); position: fixed; left: 0px; top: 0px; width:100%; height:100%; font-size: 32pt; z-index: 9998; padding-top:100px; text-align:center; font-family:\'Roboto",Arial,sans-serif;\'">' +
        '<p style="font-weight:bold;">PLAY STORE ENHANCER</p><p>Please wait while we fetch your apps</p>' + 
        '</div>');            
      
      /* set default app loader "timeout" */
      if (typeof(localStorage["applistwaittime"]) == "undefined") {
        localStorage["applistwaittime"] = 5;
      }
    }
    
    /** do once the entire list of apps is loaded */
    function appsLoaded() {
      var purchasehistory = $('.purchase-history').clone();
      var table = purchasehistory.children('table:first');
      var headerRow = table.find('thead:first > tr:first');
      
      clearAllButTable();
      prepareTable();    
      applyTableSorter();
      styleAfter();
      addTableHeaderEventHandlers();
      addMenu();      
            
      $('.loaders').fadeOut('slow');
      
      /** clears everything in body but the table */
      function clearAllButTable() {      
        console.log("clearAllButTable");
        purchasehistory.css('margin', '30px');
        $('body').children(':not(.loaders)').remove();
        $('body').append(purchasehistory);
      }
      
      /** Add the top menu */
      function addMenu() {
        console.log("addMenu");
        $('body').prepend(
          '<div id="addedtopmenu" style="padding: 20px; background-color:#F1F1F1;">' +
            '<span style="font-weight:bold">PLAY STORE ENHANCER 1.0</span>' +
            '<a href="#" id="hideFree">Show Paid Apps Only</a>' +          
            '<a href="#" id="exportCsv">Export to CSV</a>' +                    
            '<a href="#" id="adjustLoadTime">Missing apps in list?</a>' +                    
            '<a href="#" id="updateAvailable" style="display:none;">An update is available!</a>' +                    
          '</div>'
        );
        
        $('#addedtopmenu').children().css('margin-left', '30px');
        $('#addedtopmenu a').hover(function() {
          $(this).css('text-decoration', 'underline');
        }, function() {
          $(this).css('text-decoration', 'none');
        });
        
        $('#exportCsv').click(function() {        
          var uri = "data:application/csv;charset=utf-8," + encodeURIComponent(getCsv());
          window.open(uri);
          return false;
        });      
        
        $('#hideFree').click(function() {      
          $.tablesorter.setFilters( $('table'), [ '', '', '', '!Free', '', '', 'Android Apps' ], true );              
          return false;
        });
        
        $('#adjustLoadTime').click(function() {      
          var time = prompt("This bookmarklet currently determines there's no more apps to load, when the list up apps does not update for " + 
                             localStorage["applistwaittime"] + " seconds (default 5) while scrolling down. If you're on a slow/unstable connection" + 
                             ", you may want to bump this up a bit. Please enter the amount of seconds you want it to wait for the list of apps to update", localStorage["applistwaittime"]);
          
          if (time == false) return;
          
          if ( /^\+?(0|[1-9]\d*)$/.test(time)) {
            localStorage["applistwaittime"] = parseInt(time);
            alert("Thanks, the wait-timer has been updated - Please update the page and try again");            
          } else {
            alert("Sorry - that's not a valid number.");
          }                        
          
          return false;
        });      
      }
      
      /** Convert table to csv string */
      function getCsv() {
        console.log("getCsv");
        var csvLines = [];
        csvLines.push("Image URL;Name;Play Store Link;Price;Date;Status;Category");
        $('tbody:first').children('.purchase-row:not(.filtered)').each(function() {        
          var columns = [];        
          columns.push($(this).children('.purchase-image:first').find('img').first().attr('src'));
          columns.push($(this).children('.purchase-name:first').text().replace(';','\;'));
          columns.push("https://play.google.com" + $(this).children('.purchase-name:first').children('a').attr('href'));        
          columns.push($(this).children('.purchase-price:first').text().replace(';','\;'));
          columns.push($(this).children('.purchase-date:first').text().replace(';','\;'));
          columns.push($(this).children('.purchase-status:first').text().replace(';','\;'));
          columns.push($(this).children('.purchase-cat:first').text().replace(';','\;'));                
          
          csvLines.push(columns.join(';'));
        });
              
        return csvLines.join("\n");
      }
      
      /** The header column isn't formatted well for tablesorter, so fix that */
      function prepareTable() {
        console.log("prepareTable");
        /*Make sure "Name" column is in Names column, not App Icon column*/                      
        headerRow.prepend('<th></th>');
        headerRow.children().removeAttr('colspan');
        
        /*Disable table sorter on dummy column(s)*/
        headerRow.children().not('.list-table-heading').data("sorter", false).data("filter", false).addClass("nosort");        
      }            
      
      /** apply table sorter to table */
      function applyTableSorter() {                 
        console.log("applyTableSorter");
        table.tablesorter({widgets: ["filter"]})
          .on('sortEnd filterEnd', function(e, filter){                    
            $('#loading').fadeOut();
        });
        /* note: loading anim is triggered by primitive mousedown/key events
           in styleAfter(), because the sortBegin and filterBegin
           events does not show loading spinner while modifying DOM */
      }
      
      /** style the table after tablesorter has been applied */
      function styleAfter() {  
        console.log('styleAfter');
        /* bind header and filter columns together with a common class */
        $('.tablesorter-header').each(function(index) {
          if (!$(this).hasClass('sorter-false')) {
            var filterRow = $('.tablesorter-filter-row').children(':has(input:not(:disabled)):nth-child(' + (index + 1) + ')');
            
            $(this).data('col-index', index);        
            filterRow.data('col-index', index);
            
            $(this).addClass('n-col-' + index);        
            filterRow.addClass('n-col-' + index);        
            
            $(this).addClass('column');
            filterRow.addClass('column');
          }
        });    
      
        /* Make all links open in new windows/tabs */
        $('a').attr('target','_blank');        
        
        /* Table header UI improvements */
        $('.column').css('cursor', 'pointer');        
        $('.tablesorter-filter.disabled').hide();
        
        $('thead td,th').css('padding', '3px 6px');
        table.children('thead:first').css('background-color', '#F9F9F9');                            
        headerRow.children().css('border-top', '4px solid transparent');    
        
        /* bind filter and sort column hover together */                          
        $('.column').hover(function() {               
          var colSelector = '.n-col-' + $(this).data('col-index');                
          $(colSelector).css('background-color', '#F2F2F2');        
        }, function() {                
          var colSelector = '.n-col-' + $(this).data('col-index');                
          $(colSelector).css('background-color', 'transparent');        
        });                                         
      }
    
    
      /** Add table header mouseclick/typing event handlers */
      function addTableHeaderEventHandlers() {
        console.log('addTableHeaderEventHandlers');
        /* the tablesorter animation begin events doesn't work too well */
        $('.column').mousedown(function(e) {                 
          console.log($(this));
          /* left mouse button only */        
          if (e.which == 1 && !$(this).is("input")) {                    
            $('#loading').show();
            $('.sort-triangle').remove();        
            $('.tablesorter-header').css('border-top', '4px solid transparent');
          }
        });
        
        $('thead input').keypress(function() { $('#loading').show(); });
        
        table.on('sortEnd', function(e, filter) {
          $('.tablesorter-headerAsc *:not(:has("*"))').append('<span style="float:right;" class="sort-triangle">&#9650;</span>');
          $('.tablesorter-headerDesc *:not(:has("*"))').append('<span style="float:right;" class="sort-triangle">&#9660;</span>');
          $('.sort-triangle').closest('th').css('border-top', '4px solid #1AA1E1');
        });      
        
        $('.tablesorter-filter-row td').click(function() { 
          var colSelector = '.n-col-' + $(this).data('col-index');
          $('.tablesorter-headerRow').children(colSelector).trigger('sort');
        });
        
        $('.tablesorter-filter-row td input').click(function() { return false});      
        $('.tablesorter-filter-row td input').mousedown(function(e) { e.stopPropagation() });
        $('.tablesorter-filter-row td input').focusout(function(e) { $('#loading').fadeOut(); });
      }
    }  
    
    /** Fetch all apps by keeping going to the end of table/press the "more" 
        button until it seems no more apps are added to the list */
    function loadApps(onAppsLoaded) {            
      console.log('loadApps');
      
      if (debug) {
        onAppsLoaded();
        return;
      }
      
      var interval = setInterval(function() {
        
        $('#show-more-button').trigger('click');      
        $("html, body").animate({ scrollTop: $(document).height() }, 0);        
        
        var last = $('td.purchase-name > a').last().text();                        
        count = last == prevLast ? count+1 : 0;                                 
        
        if (count == 2*localStorage["applistwaittime"]) {
          console.log("DONE");
          $("html, body").animate({ scrollTop: 0 }, 0);        
          clearInterval(interval);
          
          onAppsLoaded();
          return;
        }
        
        prevLast = last;
        
        console.log("Waiting for apps (try " + (count+1) + " of " + localStorage["applistwaittime"]*2 + ")");
      }, 500);        
    }
        
  });
}());  